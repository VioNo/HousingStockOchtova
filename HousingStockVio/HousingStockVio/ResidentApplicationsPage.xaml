<Page x:Class="HousingStockVio.ResidentApplicationsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Мои заявки"
      Background="#FFFFFFFF">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Верхняя панель -->
        <Border Grid.Row="0" 
                Background="#FFFFFFFF"
                BorderBrush="#FFCCCCCC"
                BorderThickness="0,0,0,1"
                Padding="30,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Заголовок и статистика -->
                <StackPanel Grid.Column="0">
                    <TextBlock Text="🔧 МОИ ЗАЯВКИ"
                              FontFamily="Segoe UI"
                              FontSize="28"
                              FontWeight="Bold"
                              Foreground="#FF333333"/>

                    <TextBlock x:Name="StatusText" 
                              Text="Всего заявок: 0 | Открытых: 0"
                              FontFamily="Segoe UI"
                              FontSize="14"
                              Foreground="#FF666666"
                              Margin="0,5,0,0"/>
                </StackPanel>

                <!-- Панель инструментов -->
                <StackPanel Grid.Column="1" 
                           Orientation="Horizontal"
                           VerticalAlignment="Center">
                    <!-- Фильтры -->
                    <Border Background="#FFF4E8D3"
                            Padding="10,5"
                            Margin="0,0,15,0"
                            CornerRadius="8">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Фильтр:"
                                      FontFamily="Segoe UI"
                                      FontSize="13"
                                      Foreground="#FF333333"
                                      VerticalAlignment="Center"
                                      Margin="0,0,10,0"/>

                            <ComboBox x:Name="StatusFilter" 
                                     Width="130"
                                     Height="35"
                                     FontFamily="Segoe UI"
                                     FontSize="13"
                                     SelectedIndex="0"
                                     SelectionChanged="StatusFilter_SelectionChanged">
                                <ComboBoxItem Content="Все заявки"/>
                                <ComboBoxItem Content="Открытые"/>
                                <ComboBoxItem Content="В работе"/>
                                <ComboBoxItem Content="Завершенные"/>
                            </ComboBox>
                        </StackPanel>
                    </Border>

                    <!-- Кнопки действий -->
                    <StackPanel Orientation="Horizontal">
                        <Button x:Name="CreateButton" 
                                Content="+ Создать"
                                Style="{StaticResource PrimaryButton}"
                                Height="45"
                                MinWidth="120"
                                Margin="0,0,10,0"
                                Click="CreateButton_Click"
                                ToolTip="Создать новую заявку"/>

                        <Button x:Name="ViewDetailsButton" 
                                Content="👁️ Просмотреть"
                                Style="{StaticResource SecondaryButton}"
                                Height="45"
                                MinWidth="140"
                                Margin="0,0,10,0"
                                Click="ViewDetailsButton_Click"
                                ToolTip="Просмотреть детали заявки"/>

                        <Button x:Name="RefreshButton" 
                                Content="🔄 Обновить"
                                Style="{StaticResource SecondaryButton}"
                                Height="45"
                                Width="45"
                                Click="RefreshButton_Click"
                                ToolTip="Обновить список заявок"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Основное содержимое -->
        <Grid Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Таблица заявок -->
            <Border Grid.Row="0" 
                    Background="White"
                    Margin="30"
                    BorderBrush="#FFCCCCCC"
                    BorderThickness="1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Заголовок таблицы -->
                    <Border Grid.Row="0" 
                            Background="#FF67BA80"
                            Padding="20,15">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="СПИСОК МОИХ ЗАЯВОК"
                                      FontFamily="Segoe UI"
                                      FontSize="16"
                                      FontWeight="Bold"
                                      Foreground="White"/>

                            <TextBlock Grid.Column="1"
                                      FontFamily="Segoe UI"
                                      FontSize="14"
                                      Foreground="White"
                                      VerticalAlignment="Center">
                                <Run Text="Всего: "/>
                                <Run x:Name="ApplicationCount" Text="0"/>
                            </TextBlock>
                        </Grid>
                    </Border>

                    <!-- Упрощенная таблица -->
                    <ListView x:Name="ApplicationsList" 
                             Grid.Row="1"
                             BorderThickness="0"
                             SelectionMode="Single"
                             MouseDoubleClick="ApplicationsList_MouseDoubleClick">
                        <ListView.Resources>
                            <!-- Стиль для строк с разным статусом -->
                            <Style TargetType="ListViewItem">
                                <Setter Property="FontFamily" Value="Segoe UI"/>
                                <Setter Property="FontSize" Value="13"/>
                                <Setter Property="Padding" Value="10,8"/>
                                <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                <Setter Property="BorderBrush" Value="#FFEEEEEE"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Status}" Value="Открыта">
                                        <Setter Property="Background" Value="#F0F9F0"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Status}" Value="В работе">
                                        <Setter Property="Background" Value="#FFF9F0"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Status}" Value="Завершена">
                                        <Setter Property="Background" Value="#F0F0FF"/>
                                    </DataTrigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#FFF4E8D3"/>
                                    </Trigger>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="#FF67BA80"/>
                                        <Setter Property="Foreground" Value="White"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ListView.Resources>

                        <!-- Таблица -->
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="ID" Width="50" DisplayMemberBinding="{Binding Id}"/>
                                <GridViewColumn Header="АДРЕС" Width="200" DisplayMemberBinding="{Binding Address}"/>
                                <GridViewColumn Header="КАТЕГОРИЯ" Width="180" DisplayMemberBinding="{Binding CategoryName}"/>
                                <GridViewColumn Header="ОПИСАНИЕ" Width="200" DisplayMemberBinding="{Binding Description}"/>
                                <GridViewColumn Header="ОТВЕТСТВЕННЫЙ" Width="150" DisplayMemberBinding="{Binding AssignedEmployee}"/>
                                <GridViewColumn Header="СТАТУС" Width="100" DisplayMemberBinding="{Binding Status}"/>
                                <GridViewColumn Header="ДАТА СОЗДАНИЯ" Width="130" 
                                               DisplayMemberBinding="{Binding CreateDate, StringFormat='dd.MM.yyyy HH:mm'}"/>
                                <GridViewColumn Header="ДНЕЙ" Width="50" DisplayMemberBinding="{Binding DaysInWork}"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Page>